# p.563算法原理解析

## 1.概览

​		下图展示了，人工主观语音评估mos-lqs，双端和单端客观语音评估mos-lqo这三种方法的差异。

![img](file:///C:\Users\pangc\AppData\Local\Temp\ksohtml15964\wps1.png)

​		p563算法可以被想象成一个专家使用测试设备如传统的听筒侦听一个真实的电话。这个形象的表达解释了算法主要的应用并且允许使用者去对P563算法获得的分数进行评分。P563算法给出的质量分通过在测量点连接一个常规的听筒基于感知质量预测。

​		因此，侦听设备是p563算法的一部分，信号首先会被预处理。整个预处理过程由话音接收端模型开始。之后是通过语音活动检测算法（VAD）信号中包含话音的部分并计算话音电平。最终话音电平被调整到-26dbov（3300以下）。预处理过的语音数据将分别进行几项独立分析研究，像一层多个传感器，检测一组表征信号的参数。之后基于一组关键参数，开始分析主要的失真类型。

​		关键参数和分析出的主要失真类别等用于调整语音质量模型。尽管多个不同失真发生在同一个信号中，但某些失真要比其他失真作用更显著，这提供了一个基于感知的加权。P563的基础方框图下图给出。

![img](file:///C:\Users\pangc\AppData\Local\Temp\ksohtml15964\wps2.png)

​		P563算法的信号参数化可以被分为以下三个独立的函数部分，这与失真的主要类别相对应：

- **Vocal tract analysis and unnaturalness of speech声道分析和话音不自然度分析（音色音调及自然度角度）**
- **Analysis of strong additional noise强附加噪声的分析（噪声分析角度，分析与信噪比有关）**
- **Interruptions, mutes and time clipping语音间断，减弱，裁剪（语音元素完整角度）**

​		最终为了证明最终语音客观质量评分结果与语音质量主观评分mos-lqs关联，引入相关系数这一数学指标。P563和主观评分的关联程度可以用相关系数描述：
$$
r=\frac{\sum (x_{i}-\bar{x})(y_{i}-\bar{y})}{\sqrt{(x_{i}-\bar{x})^2(y_{i}-\bar{y})^2}}
$$
​		式子中，x~i~是第i种情景下主观mos得分，y~i~是对应情况下P.563算法计算出的客观质量评分，$\bar{x}$，$\bar{y}$是所有情况下的均值。

​		在已知24组遵循ITU基准的测试实验中，相关系数平均值为0.88。

## 2.详细算法原理

### 2.1语音前端相关描述符及预处理算法

#### 2.1.1  Voice activity detection端点检测

​		VAD算法基于一个自适应能量阈值，逐帧检测音频能量，超过阈值则为活跃语音信号，否则为无声段（背景噪声段），详细框图如下：

![img](file:///C:\Users\pangc\AppData\Local\Temp\ksohtml15964\wps8.png)

​		自适应能量阈值th~est~首先设定为全局均值，之后自适应逼近环境噪声值，公式如下：
$$
\left\{\begin{array}{l}
m_{x}=\sum_{i=0}^{n-1}{\frac{x_{noise}(i)}{n}}       \\
\ th_{est}=m_{x}+2*\sqrt{\sum_{i=0}^{n-1}\frac{(x_{noise}(i)-m_{x})^2}{n}}
\end{array}\right.
$$
​		还有两点额外判定：

- 如果仅12ms及以下长度的语音能量超过阈值，标记为无声段
- 活跃语音段之间的间隔小于200ms的，连接在一起

#### 2.1.2  IRS filtering中间系统滤波

​		测试的信号经过中间系统的传递后，对某些参数会造成影响。基于此，在预处理阶段需要进行一下两项步骤：

1. 对250hz到3000hz的信号进行电平估测并归一化到-26dBov处
2. 在第二步中，使用FFT滤波器对整文件在频域应用滤波器。滤波器特性与ITU-T Rec. P.830中给出的中间参考系统接收特性相似

​		滤波后的信号即可应用于语音音量衰减、非人声、帧重复、非自然哔哔声、基本音质、非自然安静、局部背景噪声和全局背景噪声的测试中。

#### 2.1.3  Signal normalization and level calculation信号归一化及电平计算

​		为了归一化到-26 dBov，算法基于VAD的输出计算每个活动帧的均方根值来估计语音水平。信号电平被归一化后，使用四阶巴特沃思高通滤波器滤波，截止频率100hz。

​		除了计算语音静默的参数要求原始信号以外，所有不使用IRS滤波信号的参数都使用这个归一化信号。

#### 2.1.4  SpeechSectionsLevelVar描述符

​		SpeechSectionsLevelVar是一个描述句子之间层次变化的描述符，它计算信号中每个语音部分的电平以及最大值和最小值之间的差值。

#### 2.1.5  LocalLevelVar描述符

​		LocalLevelVar描述信号的能量变化。均方根值是逐帧计算的。然后计算均方根数组的一阶导数，计算功率均值。

#### 2.1.6Pitch synchronous extraction基音同步分析提取

​		基音周期和基音频率数据在后续的P563算法中是需要的，基音周期及频率数据提取框图如下：

![img](file:///C:\Users\pangc\AppData\Local\Temp\ksohtml15964\wps10.png)

##### 2.1.6.1  Pitch period estimate and voice/unvoiced decision基音周期估计及浊音/清音判决

​		基音周期估计是通过自相关方法实现的，自相关计算中每一帧64ms（512个点），帧重叠面积50%。信号首先进行汉宁窗加窗处理:
$$
y_{i}=0.5x_{i}[1-cos(w)]\quad for\ i=0..(n-1)
$$
​		where:
$$
w=\frac{2\pi i}{n}\\
$$
​		x为输入信号，n为帧长度
$$
R_{y}(\tau)=y(\tau)\otimes y^{*}(-\tau)=fft^{-1}(fft(w)\times fft(w)^{*})
$$
​		$R_{y}(\tau)$基于最大值$R_{y}(0)$归一化。使用一半的韩宁窗过滤输出数组的32个之后的元素。滤波后的自相关系数N~i~由下式给出：
$$
N_{i}=\frac{R_i}{R_0}\ for\ i=0,1,2,...31\ andN_{i}=\frac{R_i}{2R_0}[1-cos(w)]\ for\ i=32,33,...,n-1
$$
​		where
$$
w=\frac{2\pi i}{64}
$$
​		然后在第20个和第100个元素之间搜索最大值，其基音频率范围从150到780 Hz。如果这个最大值大于0.5，那么这帧被归类为浊音，保存候选基音周期最大值(Tmax)。

​		为了避免基音加倍（误拾谐音），与前一次基音周期（T~old~）比较，之后先对局部蜂值（T~old~）进行维护，确定其值为局部峰值，若验证如下公式：
$$
N_{T_{old}}>\frac{1+N_{T_{old}}}{3}
$$
​		则我们判定误拾谐音，基频被翻倍，而T~old~被设置为当前帧的基音周期，更新基音周期（Tmax）。



##### 2.1.6.2  Pitch mark placement基音位置标记

​		未完待续

测试