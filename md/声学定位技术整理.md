## 基于麦克风阵列的声学定位技术，去混响技术，语音增强技术整理

### 1.摘要（Abstract）	

在复杂的声学环境下，单麦克风语音增强技术已无法需求，而麦克风阵列处理技术能够捕捉声源位置并对带噪语音进行空间滤波，从而取得明显的消噪效果。主要工作如下：

1. 归纳并总结了各种时延估计（time delay estimation，TDE）技术，特别针对一些常用的TDE方法进行了深入讨论，包括对定源和动源的跟踪能力，不同混响和信噪比条件下的抗干扰稳健性，以及算法的计算量。通过仿真结果总结出了它们各自的优缺点及适用场合。
2. 基于多麦克风的去混响（未完待续）
3. 基于多麦克风的语音增强（未完待续）

### 关键词

麦克风阵列；波束形成；时延估计；声源定位；语音增强

### 一些专业名词

| ULA   | 均匀线性阵列（Uniform Linear Array）                     |
| ----- | -------------------------------------------------------- |
| TDOA  | 到达时间差 (Time Diﬀerence Of Arrival)                   |
| DSB   | 延迟和波束形成 (Delay-and-Sum Beamforming)               |
| GCC   | 广义互相关 (Generalized Cross Correlation)               |
| ML    | 最大似然 (Maximum Likelihood)                            |
| LMS   | 最小均方 (Least Mean Square)                             |
| EVD   | 特征值分解 (EigenValue Decomposition)                    |
| ATF   | 声学传递函数 (Acoustic Transfer Function)                |
| MUSIC | 多重信号分类 (MUltiple SIgnal Classification)            |
| DOA   | 到达方向 (Direction Of Arrival)                          |
| LCMV  | 线性约束最小方差 (Linearly Constrained Minimum Variance) |
| GSC   | 广义旁瓣抵消 (Generalized Sidelobe Canceller)            |
| FDM   | 一阶差分麦克风 (First-order Diﬀerential Microphone)      |
| ANF   | 自适应零陷波束形成 (Adaptive Null Forming)               |
| TDE   | 时延估计 (Time Delay Estimation)                         |
| ILD   | 双耳电平差 (Interaural Level Diﬀerence)                  |
| PSD   | 功率谱密度 (Power Spectral Density)                      |
| VAD   | 语音活动检测 (Voice Activity Detection)                  |
| FFT   | 快速傅立叶变换 (Fast Fourier Transform)                  |
| RMSE  | 均方根误差 (Root Mean Square Error)                      |
| SNR   | 信噪比 (Signal-to-Noise Ratio)                           |
| CRLB  | Cramer-Rao下界 (Cramer-Rao lower bound)                  |
| LS    | 最小二乘 (Least Square)                                  |
| SX    | 球形交集 (Spherical Intersection)                        |
| SI    | 球形插值 (Spherical Interpolation)                       |
| QCLS  | 二次纠正最小二乘 (Quadratic-Correction Least Squares)    |
| LCLS  | 线性纠正最小二乘 (Linear-Correction Least Squares)       |

### 第一章 绪论

#### 1.1研究背景

实际声学环境如图1.2

<center><img src="https://pangcong1117.github.io/myblog/images/基于麦克风阵列的声源定位与语音增强方法研究_图1.4麦克风接收带噪语音模型.png"/>




#### 1.2阵列信号处理的背景知识

从声波的传播模型出发，获得了阵列接受信号的响应方差式，并在此基础上给出麦克风阵列波束形成以及阵列指向角的概念。通过定义阵列的空间采样率和信号的空间重复频率，指出了空间混叠现象，进而类比时域的Nyquist采样得出空间采样定理。这些为后续麦克风阵列的声源定位和语音增强奠定了基础。

##### 1.2.1 波动方程


$$
x(t,\boldsymbol{r})=-\frac{A}{4\pi r}e^{j(\omega t-kr)}=-\frac{A}{4\pi r}e^{j(\omega(t-r/c))} \tag{1-4}
$$


波动方程给出了特定频率的声波传播到空间任一点处的声压强度，可以看出其相移和幅度都是**传播距离的函数**。

##### 1.2.2麦克风阵列与波束形成

麦克风阵列是指由两个或多个麦克风按照一定的几何结构排列而成的阵列。按照拓扑结构不同，麦克风阵列可以分为均匀线性阵列（uniform linear array，ULA）、非均匀线性阵列、非线性阵列、环形阵列、二维（平面）阵列、三维（立体）阵列等等。

$$
D(f,\theta,\phi)=\sum_{m=0}^{M-1}w_m(f)e^{jkmdsin\phi cos\theta}\tag{1-5}
$$


通过改变加权函数$\omega_m(f)$来设计波束的形状和指向。

为了说明波束指向这一概念，令$a_m(f)=1$，则方向图函数为
$$
D(f,\theta,\phi)=\sum_{m=0}^{M-1}e^{j[kmdsin\phi cos\theta+\varphi_m(f)]} \tag{1-6 }
$$
如果相位响应满足
$$
\varphi_m(f)=-kmdsin\phi^,cos\theta^,\tag{1-7}
$$
式（1-6）可变为
$$
D^,(f,\theta,\phi)=\sum_{m=0}^{M-1}e^{jkmd(sin\phi cos\theta-sin\phi^, cos\theta^,)} \tag{1-8}
$$
此时阵列的主瓣将指向（$\theta=\theta^,\phi=\phi^,$），或者说阵列对来自于[$\theta^,,\phi^,$]方向的信号具有最大增益。

##### 1.2.3空间采样定理

利用阵列对信号进行空间采样时，阵元的间距需要满足一定的约束关系。简单地，以2个麦克风$m_1、m_2$为例进行说明。麦克风间距$d$越大，波束带宽越窄，空间分辨率越强，但是d的取值并不可以无限增大，它要收到信号波长的限制。

时域采样定理指出，为防止信号的频谱发生混叠，信号的采样频率应满足Nyquist准则，即
$$
f_s=\frac{1}{T_s}\geq2f_{max}\tag{1-9}
$$
其中，$f_s$为时间采样频率，$T_s$为采样周期，$f_{max}$为信号的最高频率。麦克风阵列其本质是对信号进行空间采样。与时域采样定理类似，阵列的采样率必须满足一定的条件才不会引起空间混叠。对于ULA，空间采样率定义为：
$$
F_s=\frac{1}{d}\tag{1-10}
$$
当目标声源的入射角为$[\theta,\phi]$时，该信号在空间的重复频率为$F=sin\phi cos\theta/\lambda$。为避免空间混叠，要求
$$
F_s\geq2F_{max}=\frac{2sin\phi cos\theta}{\lambda_{min}}\tag{1-11}
$$
其中，$\lambda_{min}$为信号的最小波长。由此可得空间采样定理
$$
d\leq\frac{\lambda_{min}}{2}\tag{1-12}
$$
#### 1.3麦克风阵列语音信号处理模型

与传统阵列信号处理模型相比，主要有以下特点：

1. 远场假设不再成立，声源既有可能位于近场范围内，又可能位于阵列的远场中，因此，不能忽略各通道接受信号的幅度差，且要采用更为准确的球面波前模型；
2. 麦克风阵列信号处理的语音信号不再是窄带信号，阵元之间的相位差为频率和信号源位置的复合函数
3. 在室内环境下，空间干扰源（包括噪声以及混响）和语音信号同时辐射在阵列上，这增加了处理模型的复杂度。

##### 1.3.1带噪语音模型

实际中，麦克风接收到的信号会受到噪声的干扰，如图1.4所示。

<center><img src="https://pangcong1117.github.io/myblog/images/基于麦克风阵列的声源定位与语音增强方法研究_图1.4麦克风接收带噪语音模型.png"/>


根据式（1-4），结A/D变换后的第$i$个麦克风接收到的信号可以表示为
$$
x_i(n)=a_is(n-\tau_i)+v_i(n)\tag{1-13}
$$
其中$v_i(n)$是加性噪声，$α_i$是声波传播衰减系数$(α_I< 1)$，$\tau_i$为声源到达第$i$个麦克风的传播时延$(\tau_i= r_i/c)$。

在封闭的声学环境中，接收到的声音会经墙壁反射而在此到达麦克风，如图1.5所示。

<center><img src="https://pangcong1117.github.io/myblog/images/基于麦克风阵列的声源定位与语音增强方法研究_图1.5封闭环境中的声波传播模型.png"/>


此时，麦克风接收到信号不再是简单的叠加，而是加入了信号源$s(n)$的多个延迟版本，如下

$$
x_i(n)=h_i(n)\ast s(n-\tau_i)+v_i(n)\tag{1-14}
$$
其中$a_{ip}$和$\tau_{ip}$分别为第$p$条反射路径到达第$i$个麦克风的衰减和时延。$h_i(n)$称为房间的单位冲激响应。由于声音直接到达麦克风的路径最短，所以有$\tau_{ip}$>$\tau_i$。同时，信号经过多次反射幅度也会降低，满足$a_{ip}<a_i$。事实上，$a_{ip}$以$\tau_{ip}$的指数形式衰减，随着反射次数增加，信号幅度衰减很快。

为模拟房间的混响和反射效应，J.B.Allen给出了映像算法 (image method) 来计算房间内任意两点间的声学通道响应[23]。 

##### 1.3.2室内混响

声源直接到达接收点的声音称为直达波，而经过墙壁一次或多次反射后到达接收点的声音称为反射波。反射波分为两种，如果到达听着的直达声和第一次反射声之间，或者相继到达的两个反射声之间在时间上相差50ms以上，而反射声的强度又足够大以至使听着能明显分辨出两个声音的存在，那么这种反射声为回声。回声的存在会严重影响室内的听音效果，一般应力求排除，而一定的混响声却是有益的，它可以增加声音的强度。混响是有界空间的一个重要声学特征，无界空间不存在这一现象。

假设声源在发声一段时间后突然停止，声音在室内将不停反射、逐渐衰减。设声源停止时刻为t = 0s，此时室内平均能量密度是$ε_0$。假设房间的平均吸声系数为$a$，在经过第一次墙壁反射后室内平均能量密度变为$ε_1= ε_0(1 − a)$，第二次墙壁反射后$ε_2= ε_0(1 − a)^2$，N次反射后平均能量密度为$ε_N= ε_0(1 − a)^N$。

设房间的平均自由程为$ \overline{L}$（它表示声音在室内墙壁两次反射之间的平均距离，因为每两次反射之间的传播距离不同，所以只能用统计的方法表示），那么有
$$
\overline{L}=\frac{4V}{S}\tag{1-15}
$$
其中，V是房间体积
$$
V=l_xl_yl_z\tag{1-16}
$$
S 是房间内壁总面积
$$
S=2(l_xl_y+l_xl_z+l_yl_z)\tag{1-17}
$$
$l_x$、$l_y$和$l_z$是房间尺寸。根据平均自由程可知，在时间t内发生的反射次数应是
$$
\frac{ct}{\overline{L}}=\frac{cS}{4V}t\tag{1-18}
$$
于是$t$时间后的平均能量密度表达式为
$$
\epsilon_1=\epsilon_0(1-a)^{cSt/(4V)}\tag{1-19}
$$
因为在扩散声场中，各点的总平均能量密度可以看成是许多互不相干声源的平均能量密度的叠加，根据总平均能量密度与总有效声压的平方关系可以推出
$$
p_e^2=p_{\epsilon0}^2(1-a)^{cSt/4V}\tag{1-20}
$$
其中，$p_e$是室内时刻t的有效声压，$p_{e0}$为0时刻的有效声压。定义扩散声场中，当声源停止后从初始声压级降低60dB所需要的时间称为混响时间，用符号$RT_{60}$表示，它代表了室内声音传播衰减的快慢程度。按混响时间的定义可以得到
$$
RT_{60}=55.2\frac{V}{-csln(1-a)}\tag{1-21}
$$
如果室内平均吸声系数较小，满足$a$ < 0.2，那么由于$ln(1 − a) = −a$，上式可近似为
$$
RT_{60}=0.161\frac{V}{Sa}\tag{1-22}
$$
它最先由美国声学家Sabine从实验中获得，因此命名为Sabine公式。考虑到空气吸收对混响时间的影响之后，又提出修正的Sabine公式
$$
RT_{60}=0.161\frac{V}{Sa+4mV}\tag{1-23}
$$
式中$m$是声强吸收系数，它不仅与媒介的性质和状态有关，而且还是声波频率的函数。一般来说频率越高吸收系数增加越快，它在修正Sabine公式中的贡献越大。在一般室内环境下，对4KHz声波，空气吸收和墙面吸收的贡献基本相当；2KHz 时墙壁吸收要比空气吸收大一些；而对于频率低于1KHz的声波，空气的吸收基本可以忽略不计。

混响时间对人的听音效果有重要影响，它仍然是迄今为止描述室内音质的一个最为重要的参量。混响过长会使人感觉声音浑浊不清，使语音清晰度下降；混响时间太短又有沉寂的感觉，声音听起来很不自然。一般来讲，对音乐的混响时间要场一些，使人听起来有丰满的感觉，而语音则要求混响时间短一些，有足够清晰度。

想法：AR模拟混响过程，进行反混响，逆过程去混响



#### 1.4研究现状

##### 1.4.1麦克风阵列声源定位技术的研究现状

大体包括三类：基于最大输出功率的可控波束形成技术、基于到达时间差（time difference of arrival，TDOA）的定位技术和基于高分辨率谱估计的定位技术。

（1）基于最大输出功率的可控波束形成定位方法

该方法对麦克风所接收到的声源信号滤波并加权求和来形成波束，进而通过搜索声源可能的位置来引导该波束，最终那个使波束输出功率最大的点就是声源的位置。这类方法中最简单的是延迟和波束形成法（delay-and-sum beamforming，DSB）。该方法对麦克风信号采用时间移位以补偿声源到麦克风的传播延迟，并通过相加求平均来获得阵列的输出。更复杂一些的波束形成法在进行时间较真的同时，还对信号进行滤波，称为滤波和波束形成（filter-and-sum beamforming，FSB）方法。

可控波束形成技术本质上是一种最大似然估计，它需要声源和环境噪声的先验知识。在实际使用中，这种先验知识往往很难获得。此外，最大似然估计是一个非线性最优化问题，这类目标函数往往有多个极点，且该方法对初始点的选取也很敏感。因此，使用传统的梯度下降算法往往容易陷于局部极小点，从而不能找到全局最优点。若要通过其他搜索方法找到全局最优点，就会极大地增加复杂度。

（2）基于TDOA（到达时间差）的定位方法

基于TDOA的定位方法是一种双步定位方法。该方法首先估计信号到达不同麦克风之间的时间差，进而通过几何关系来确定声源的位置。

对这一方法，稳健的时延估计是进行准确定位的基础。现有的时延估计方法根据所利用的物理参量不同可以分为两类：一是利用互相关函数的时延估计方法，如广义互相关（generalized cross correlation，GCC）法，最大似然（maximum likehood，ML）加权法，互功率牌相位（cross-power spectrum phase，CSP）法等；二是通过求取路径的脉冲响应（或传递函数）来获取TDOA估计，这些方法包括自适应最小均方（least mean square，LMS）方法、特征值分解法（eigenvalue decomposition，EVD）以及基于传递函数比（acoustic teansfer functions ratio，ATF比）的方法等。考虑到时延估计在麦克风阵列信号处理中的重要性，本论文首先归纳并总结了现有常用的时延估计技术，进而从三个方面（对定源和动源的跟踪能力，在不同混响和信噪比环境下的稳健性，及算法的计算量）深入讨论了不同算法所具有的特点，并由此总结出个方法的适用场合。

在获得TDOA后，乘以声速就得到距离差。在2D平面内，根据集合关系可知这样的点满足双曲线方程。一对麦克风可得一条双曲线，两对麦克风即可获得交点就是声源位置。上述方法要确定一个2D平面内的点至少需要3个麦克风，这限制了麦克风阵列的小型化。

想法：可以通过两麦克风能量衰减，综合TDOA判别声源位置。

基于时延的定位方法计算量小，在实际系统中可以实时实现，因而获得了很多关注。然而该方法的不足之处在于：首先，估计时延和定位分成了两个阶段来完成，时延中的误差会进一步传递到下一步的位置估计中，产生误差积累，这在某种意义上知识对声源位置的次最优估计；其次，无论是基于互相关函数还是通过传递函数求取的时延，TDOA估计都是以信号的采样数目来衡量的，采样率越高，可以达到的精度才会越高，这会对信号的采样频率产生特殊的要求。此外基于TDOA的定位算法比较适合单源的定位，而对多源问题显得有些无能为力。

（3）基于高分辨率谱估计的定位方法

该方法来源于一些现代高分辨率谱估计技术，如自回归模型（autoregressive，AR）、最小方差谱估计（minimum variance，MV）、多重信号分类（multiple signal classification，MUSIC）方法等，它们利用EVD（特征值分解EigenValue Decomposition）将数据的协方差矩阵分解为信号子空间和噪声子空间，然后找出与噪声子空间的方向矢量来获得声源的方向估计。

与TDOA估计法相比，基于高分辨率谱估计的定位方法是一张超分辨率的估计技术，其空间分辨率不会受到信号采用频率的限制，并且在一定条件下可以实现任意定位精度，这一特性使它在阵列信号处理中获得了成功应用。然而，针对实际问题，该类方法也存在一定的不足，主要表现在：（1）算法是利用相关矩阵中最大几个特征值来判定声源位置的，一旦有方向性噪声出现，且其能力与声源相差不大，算法有时会找到方向性噪声的方向；（2）房间的反射作用使信号和干扰之间有一定的相关性，从而极大的降低了该方法的有效性；（3）这一方法需要对整个空间进行搜索来确定声源的位置，且其估计精度与空间的细分程度有关，计算复杂度偏高。

针对上述问题，本文提出了基于搜索空间预估计的高分辨率方位（directon of arrival，DOA）估计方法。首先，利用处理速度快的TDOA估计技术来获得一个包含声源方向的预估计空间，进而在此空间内执行高分辨率谱估计的方法来定位，就可以有效的降低高分辨率方法的计算量。此外，由于TDOA估计可以抵抗方向性的干扰噪声，因而通过该方法获得的搜索空间还可以部分地去除方向性干扰的方向，从而提高定位系统的抗噪稳健性。

##### 1.4.2麦克风阵列语音增强技术的研究现状

国际上，将麦克风阵列技术用于语音信号处理的研究相对较晚。麦克风阵列语音增强方法的研究始于80年代，并在90年后期逐渐成为研究热点。

最早的麦克风阵列语音增强方法是Flanagan在85年提出的DSB方法。通过DSB所形成的波束，其主瓣的宽度与信号的频率相关，这在目标声源偏离波束最大增益方向时会引起语音的失真。为了改善阵列对宽带信号的响应特性，在DSB基础上又形成了FSB方法，这种方法对各支路信号不是简单的延迟，而是通过一定长度的FIR滤波器来实现频率不变的空间响应特性，也称恒定指向波束形成（constant directivity beamforming，CDB）技术。这类方法算法简单，原理明了，然而通常需要大数量的麦克风才能达到较好的消噪效果。此外，它适合于消除非相干噪声或散射噪声，而对相干噪声没有消除能力，因此对于方向性噪声和房间混响等不能有效清除。

上述算法在滤波器设计完成后就不再变动，因而成为固定波束形成器。然而在某些环境下，信号和噪声的统计特性使随时间变化的，这就需要利用自适应波束形成方法来处理。自适应波束形成基于最小方差无畸变响应（minimum variance distortionless response，MVDR）准则，**其原理是在保证期望方向信号不变的条件下，是阵列的输出功率达到最小来抑制噪声**。O.L.Frost于1972年提出了线性约束最小方差波束形成（Linearly constrained minimum variance，LCMV）算法，它将MVDR的约束条件用一组线性方差来表示，方便了MVDR的实现。L.J.Griffith和C.W.Jim于1982年提出的旁瓣抵消算法（generalized sidelobe canceller，GSC）将LCMV中带约束的最优化问题转变为不带约束的最优化问题，进而简化了优化问题的求解过程。

在传统的自适应波束形成方法中，对于注视方向上信号的频率响应是固定的，约束条件知识对期望语音的处理，并没有消噪能力。针对该问题，S.Fischer和K.U.Simmer提出了一种具有自适应约束值的多通道语音增强方法，它是一种改进的线性约束波束形成方法。这种方法对于注视方向上信号的约束条件是自适应的，它能随着接收信号特性的变化而变化，因此可以在一定程度上消除相干噪声和非相干噪声。

G.W.Elko和A.T.N.Pong在1995年提出一阶差分麦克风阵列（first-order differential microphone，FDM）技术。不同于前述算法在阵列的侧向形成波束，该方法的最大波束指向阵列的轴向，并在噪声方向形成波束零点，从而去除干扰噪声。Luo等通过对一阶差分麦克风阵列技术的进一步研究，找出了滤波器系数与信号延迟之间的对应关系，由此获得了最优的滤波器增益函数及相关的自适应算法--自适应零陷波束形成（adaptive null  forming，ANF）方法。这类方法对于相干性噪声具有很强的抵消能力，特别是当噪声与声源分别位于阵列的两侧时。

这些多通道语音增强技术为处理复杂的声学环境提供能了基础。近几年，许多语音童心男设备都在向着小型化的方向发展。为了能将麦克风阵列嵌入到此类语音通信设备中，这就要求阵列的尺寸不能太大。以DSB和GSC为代表的侧向阵列波束形成技术，通常需要多个麦克风才能达到较好的增强效果，并且阵列的尺寸越大，所形成的波束越窄，消除噪声的能力才会越强。而轴向阵列波束形成技术（FDM阵列技术、ANF技术），可以通过两个麦克风实现，因而成为小型化设备关注的重点。本论文着重于该技术的研究，并在此基础上提出了基于FDM阵列的谱域语音增强方法。考虑到ANF算法需要通过时域的自适应滤波来消除噪声，这在滤波系数未收敛（算法处理初始阶段，或者噪声方向发生变化）的情况下，会造成噪声的泄露。针对这一问题，本论文通过结合单通道的谱增强技术，提出了与ANF方法等价的谱域滤波器，改善了噪声泄露问题。



### 第二章 时间延迟估计技术

在各种基于麦克风阵列的语音处理系统中，时间延迟估计（time delay estimation，TDE）都是一个基本问题。例如，利用麦克风阵列对讲话者进行定位，其基本思想就是根据估计出的各通道信号之间的时间延迟来确定目标的方位和距离。

#### 2.2时间延迟估计

最初得到广发应用的**包括GCC方法和LMS方法**。鉴于GCC收混响的影响比较严重，Champagne和Brandstein等人分别对其进行了改进，提出了**倒谱预滤波（cepstral prefiltering，CEP）技术**，通过对通道特性的分析，有目的地去除信号中受反射影响严重的部分，再将域滤波后的信号通过GCC方法进行时间延迟估计。与CEP方法不同，Brandstein提出的**基音加权的GCC方法**更多地考虑了信号本身的特性，特别适用于具有周期特性的信号源，如语音。近年来，Benesty和Dvorkind等人又分别提出基于EVD和基于ATF比的时延估计方法，前一种基于子空间的技术，后一种利用信号到达两个麦克风的传递函数比来求解的。

##### 2.2.1麦克风信号产生模型

根据1.3一节给出的麦克风阵列语音信号处理模型，在没有混响的情况下，两个麦克风mi和mj接收到的信号$x_i(n)$和$x_j(n)$分别为：
$$
x_i(n)=a_is(n-\tau_i)+v_i(n)\tag{2-1}
$$

$$
x_j(n)=a_js(n-\tau_j)+v_j(n)\tag{2-2}
$$

当房间中存在混响时，两麦克风接收到的信号变为：
$$
x_i(n)=a_is(n-\tau_i)+\sum_{p=1}^{P}a_{ip}s(n-\tau_{ip})+v_i(n)=h_i(n)\ast s(n)+v_i(n)\tag{2-3})
$$

$$
x_j(n)=a_js(n-\tau_j)+\sum_{p=1}^{P}a_{jp}s(n-\tau_{jp})+v_j(n)=h_j(n)\ast s(n)+v_j(n)\tag{2-4})
$$

此时，直达路径之间的时间差$τ_{ij}= τ_i− τ_j$给出了麦克风$m_i$与$m_j$的时间延迟，也称到达时间差 (time diﬀerence of arrival, TDOA)。下面将依次讨论各种TDOA估计算法。



##### 2.2.2广义互相关时延估计法

Knapp和Carter提出的广义互相关（generalized cross correlation，GCC）方法是一种传统的TDE方法。由于来自同一声源的信号存在一定相关性，通过计算不同麦克风所接收到的信号之间的相关函数，就可以估计出TDOA值。然而在实际环境中，由于噪声和混响的影响，相关函数的最大峰值会被弱化，有时还会出现多个峰值，这些都造成了实际峰值检测的困难。GCC方法就是在功率谱域对信号进行加权，突出相关信号部分而抑制受噪声干扰的部分，以便使相关函数在时延处的峰值更为突出。

针对两个麦克风$m_i$和$m_j$，其接收到的信号$x_i(n)$和$x_j(n)$的互相关函数$R_{x_ix_j}(τ)$可以表示为

$$
R_{x_ix_j}(\tau)=E[x_i(n)x_j(n-\tau)]\tag{2-5}
$$
其中，$E[·]$为数学期望。在无混响的条件下，将式(2-1)和(2-2) 代入(2-5)可得
$$
R_{x_ix_j}(\tau)=a_ia_jE[s(n-\tau_i)s(n-\tau_j-\tau)]+a_jE[s(n-\tau_j-\tau)v_i(n)]+E[v_i(n)v_j(n-\tau)]\tag{2-6}
$$
由于噪声与声源之间互不相关，因此式(2-6)可以简化为
$$
R_{x_ix_j}(\tau)=a_ia_jR_{ss}(\tau-\tau_{ij})+R_{v_iv_j}(\tau)\tag{2-7}
$$
其中$R_{ss}(τ)$是声源$s(n)$的自相关函数，$R_{v_iv_j}(τ) $为噪声$v_i(n)$和$v_j(n)$的互相关函数。

式子表明，如果信号的信噪比足够大，TDOA是可以从互相关函数的峰值位置来获得。

由相关函数的傅立叶变换给出了两通道信号的互功率谱，如下
$$
\Phi_{x_ix_j}(\omega)=a_ia_j\Phi_{ss}e^{-j\omega\tau_{ij}}+\Phi_{V_iV_j}(\omega)\tag{2-8}
$$
其中$Φ_{SS}(ω)$，$Φ_{XiXj}(ω)$和$Φ_{ViVj}(ω)$分别对应了$R_{ss}(τ)$，$R_{xixj}(τ)$和$R_{vivj}(τ)$的功率谱。广义互相关函数被定义为
$$
R_{GCC}(\tau)=\int_{-\infty}^{+\infty}\Psi_{ij}(\omega)\Phi_{x_ix_j}(\omega)e^{i\omega \tau}d\omega \tag{2-9}
$$


下面给出利用GCC法进行时间延迟估计框图

<center><img src="https://pangcong1117.github.io/myblog/images/基于麦克风阵列的声源定位与语音增强方法研究_图1.5封闭环境中的声波传播模型.png"/>


其中$ψ_{ij}(ω)$为GCC的加权函数。实际中，针对不同的噪声和混响情况可以选择不同的$ψ_{ij}(ω)$。GCC方法的基本思想可以用图2.1来表示，其中$(·)∗$为取共轭运算。

文献[31]中作者给出了多种通用的加权函数。为便于比较，本论文中以表格的形式将其列出。可以看出，GCC方法是建立在非混响模型基础上的。受模型误差的影响，它不能正确辨识多个说话人和方向性的干扰噪声，并且更倾向于估计强信号的TDOA值，所以GCC方法通常用于低混响和非相关噪声的场合。然而在视频会议中，绝大部分的噪声均来自于方向性的干扰源，例如，CPU风扇、投影仪和空调等等。尽管如此，低的计算复杂度和易于实现的特点使得GCC方法还是得到了比较广泛的应用。

下面给出了多种通用的加权函数：

<center><img src="https://pangcong1117.github.io/myblog/images/基于麦克风阵列的声源定位与语音增强方法研究_表2.1各种GCC加权函数及其特性.png"/>


##### 2.2.3倒谱预滤波时延估计方法

由2.2.2节可知，GCC方法尽管考虑了噪声影响，但它假定声源到麦克风之间的通道响应为一简单的延迟和衰减，Champagne在96年的文章中指出这样的近似是不准确的。特别地，当混响超过一定限度时，TDOA异常估计（所谓异常，是指偏离实际值较大的TDOA估计）的百分比会突然增加。这是由于随着混响程度的增加，反射波在相关函数计算中的峰值会随之增加，加上噪声的影响，最终超过真实的峰值，造成相关估计器的输出产生大的偏差。见下图

<center><img src="https://pangcong1117.github.io/myblog/images/基于麦克风阵列的声源定位与语音增强方法研究_图2.2无混响和有混响条件下的广义互相关函数.png"/>


图2.2表明混响对时延估计造成了很大的干扰。针对这一问题，Champagne提出在GCC前端加入倒谱预滤波（cepstral prefiltering，CEP）来改进GCC算法。

倒谱在信号处理有着广泛的用途，它主要的功能是可以线性分离经卷积后的两个或多个分别的信号

此时采用的信号模型为混响模型（2-3）和（2-4），对式（2-3）两边做倒谱变化可得

$$
\widehat{x}(k)=\widehat{h}(k)+\widehat{s}(k)+\widehat{v}(k)\tag{2-10}
$$
其中，这四个符号分别是x(n)、h(n)、s(n)和v(n)的倒谱。

最终，麦克风信号x（n）的倒谱可以进一步谢伟
$$
\widehat{x}(k)=\widehat{h}_{min}(k)+\widehat{h}_{ap}(k)+\widehat{s}(k)+\widehat{v}(k)\tag{2-15}
$$


由于时间延迟$\tau_{ij}$相当于频域上乘以因子$e^{-jw\tau_{ij}}$，作者指出，路径中的混响主要包含在系统的MPC中，而APC则解释了信号传播的时延。入股将通道响应分为APC和MPC两部分，并保留其中的APC分类用于GCC求相关，就可以在一定程度上抑制混响的影响，提高时延估计算法的抗混响性能。但是如果直接从观测信号的倒谱$\widehat{x}(k)$中减去该信号的最小相位倒谱$\widehat{x}_{min}(k)$来计算GCC，会使得信号的相关性变差，而如果只减去$\widehat{h}_{min}(k)$则不仅能较好的消除混响的影响，而且相关函数也具有比较尖锐的峰值。因此在倒谱预滤波方法中，需要先估计出$\widehat{h}_{min}(k)$，然后从$\widehat{x}(k)$中减去$\widehat{h}_{min}(k)$部分得到$\widehat{x}^,(k)$，经逆倒谱变换再做互相关。加入这些预处理后的GCC时间延迟估计就能有效地降低混响的影响，而且也具有一定的抗噪性能。

然而，CEP方法也存在一些问题，首先，帧长的选择比较困难。在分帧处理过程中，帧长的选择不能过大以确保通道的特性是时不变或者是慢变的（语音短时平稳特性），另一方面，帧长要足够大才能使功率谱的计算不受帧长的影响，也就是要避免当前帧的发射出现在下一帧或者前一帧的反射出现在当前帧。通常倒谱的估计需要比较长的帧长（200ms），同时还需要几帧的平滑，因此需要将近1s的语音信号，这导致了较大的延迟。其次，CEP方法认为通道的MPC是固定不变的，这样的假设通常难以满足。实际上，人的走动和开门等一些因素都会导致房间混响的变化，对于动源来说，帧间重叠可以保证跟踪精度，但两帧之间的时移动，并不能保证信号MPC的均值为0。最后，从计算量上来讲，倒谱的计算需要多做2次FFT和1次求对数运算，而且要随着通道特性的变化不断更新，这都增加了额外的计算量。所以，CEP-GCC方法虽然能够取得较好的效果，但要实现实时处理还比较困难。 



##### 2.2.4互功率谱相位时延估计法

互功率谱相位（cross-power spectrum phase，CSP）法是利用互功率谱的相位信息来估计时延，它对信号互功率谱的加权函数为

$$
\Psi_{csp}(\omega)=\frac{1}{|\Phi_{x_ix_j}(\omega)|}\tag{2-17}
$$
这一方法等价于PHAT加权的GCC方法。有文献【28】提出，通过对CSP时延估计法的性能分析提出了改进的CS方法，其处理过程中将分母$|\Phi_{x_ix_j}(\omega)|$变为$|\Phi_{x_ix_j}(\omega)|^\gamma(0.5\le\gamma\le1)$，并通过信噪比对多帧CSP进行加权平均，从而改善了算法在中度以上环节噪声和强混响下的性能。

另外，文献[64]给出了一种多通道的广义互功率谱相位 (generalized CSP，GCSP)时延估计方法。它将多通道信号的相关矩阵分解为信号部分和噪声部分，再利用其中的信号部分估计互功率谱。由于增加了空间信息，利用GCSP进行时延估计的性能要优于CSP，然而这增加了设备的复杂度。

##### 2.2.5结合语音特性的基音加权时延估计法

前述的利用互相关进行时延估计的方法都没有考虑信号本身的特性。文献【58】中作者提出，信号中具有明显周期特性的部分受到外围噪声和多径干扰的影响比较小，如果对信号中表现出周期特性的频谱给以适当的加强，就可以在一定程度上提高抗噪和抗混响的性能，这便是基音加权的时延估计法，其加权函数如

$$
\Psi_p(\omega)=\frac{(1-max(E_{mi},E_{mj}))^\gamma}{|\Phi_{x_ix_j}(\omega)|}\tag{2-18}
$$
其中$E_{mi}$为第i个麦克风处第$m$个谐波分量的归一化误差。

这种方法相当于改进的PHAT加权，它将两通道中共同的信号分量（更可能为语音的部分）加强，而其它部分（噪声）被抑制，从而提高了噪声和混响下的时延估计性能。另一方面，由于考虑了信号自身的特性，它也适合于多源检测问题，此时为提取每个源的基音和谐波分量，处理器的复杂度会相应地增加。



##### 2.2.6基于人耳感知特性的时延估计

人耳利用两耳间强度差（interaural level difference，ILD）和两耳间时间差（interaural time difference，ITD）来确定声源的位置。人在有混响的房间里也能正确的辨认出声源的位置，这主要是利用了直达声音的优先效应（precedence effect），即声音的直接分类总是先于反射分量到达人耳，也就是说人耳利用了未被反射污染的声音段来定位，这段声音称为初始段。因此在求时延时，如果能够提取初始段来计算GCC，就能较好地抑制混响。

语音信号从小段来看明显呈周期性，而语音段的包络体现了语音的到达时间，或者说包络可以部分地掩盖反射，因此可以提取语音信号的包络来求解信号的相关函数

对于两个麦克风接收到的信号$x_i(n)$和$x_j(n)$，其包络为：

$$
A_i^{env}(n)=max[\beta A_i^{env}(n-1),|x_i(n)|]\tag{2-19}
$$

$$
A_j^{env}(n)=max[\beta A_j^{env}(n-1),|x_j(n)|]\tag{2-20}
$$



从包络中提取初始段，主要是提取出上升段，下图2.3

<center><img src="https://pangcong1117.github.io/myblog/images/基于麦克风阵列的声源定位与语音增强方法研究_图2.3信号包络提取的初始段信号.png"/>


通过提取包络初始段来进行时延估计的缺点在于，它受外围环境的影响比较大，如房屋几何尺寸、声源和麦克风位置，以及麦克风特性等等。

上面所列的算法都是利用了互相关来进行时延估计，包括GCC。下面将从另一个角度出发，介绍通过估计路径的脉冲响应（或传递函数）来获取TDOA的方法，这一类方法包括了**自适应的LMS方法、基于子空间的EVD方法以及基于ATF比的方法**。

##### 2.2.7基于LMS的自适应时延估计法

自适应的最小均方（least mean square，LMS）滤波能根据当前输入信号的采样来自适应地调整滤波器系数，使输出误差信号达到最小。这一过程不需要输入信号谱的先验知识，因此LMS算法被广泛得用于输入信号的统计特性未知的情况下。基于同样考虑，LMS算法也被成功地引入到时延估计中来。

对于两个麦克风接收到的信号，如果以一个通道的信号为目标信号，另一个通道的信号为参考信号，就可以利用LMS方法来进行TDOA估计，其实现框图如2.4

<center><img src="https://pangcong1117.github.io/myblog/images/基于麦克风阵列的声源定位与语音增强方法研究_图2.4LMS时延估计原理框图.png"/>


从图2.4中看出，LMS时延估计器自动调节$h（n）$，使第二个通道的输出逼近第一个通道输出，实质上相当于在通道2信号中插入一个延迟来使两个通道信号对齐。理想情况下，$h（n）$对应于实际时延处的加权系数会收敛到1，而其它部分则收敛到0。

$$
H(\omega)=\Phi_{x_ix_j}^{-1}(\omega)\Psi_{x_ix_j}(\omega)\tag{2-23}
$$


比较表2.1中的Roth处理器可以看出，在统计意义下，LMS方法与Roth 加权的GCC估计法相似，但是两者的出发点和前提条件是不同的。GCC是从信号互相关的角度来进行时延估计，它基于信号和噪声的先验知识，需要大量数据运用统计的方法得出，而实际操作中，GCC方法往往只用一帧数据就获得信号的功率谱和互功率谱的估计，因此该估计的精度不高。LMS自适应滤波则通过一定的误差准则，让一个通道的信号去逼近另一个，在收敛的情况下给出时延估计，它不需要信号谱的任何先验知识，因此LMS时延估计方法可以看作Roth处理器的自适应实现。

对于LMS方法，其缺陷在于：首先，自适应算法需要一个学习过程，运算量要远大于GCC，所以对快速移动的声源的跟踪比不上GCC方法；其次，这种方法对周期信号的效果比较差，而语音信号从局部来看明显呈周期性，并且信号xi(n)和xj(n)都是通过房屋的反射形成的，用xj(n)直接去逼近xi(n) 而得到两者的关系会比较困难；再次，LMS 滤波器虽然不需要预先知道输入信号的统计特性，但却依赖于其统计特性，信号分布越接近于白化，TDE的性能越好；最后，它的性能还与滤波器长度有关，长度越长，TDE的精度越高，但是计算复杂度也随之快速地增长，从而导致处理速度过慢。总之，利用LMS进行时延估计的最大问题就是**计算量太大**。

##### 2.2.8基于子空间分解的时延估计法

目前，基于子空间分解的时延估计方法主要包括了自适应特征值分解（eigenvalue decomposition，EVD）【35】算法和自适应广义EVD（generalized EVD,GEVD）算法【11,59】。Benesty提出的EVD方法可用于处理空间非相关噪声，随后Doclo等人利用GEVD方法将其扩展到空间相关噪声的情景。

基于EVD的时延估计方法针对有混响的环境模型，其接收信号为：

$$
x_i(n)=h_i(n)\ast s(n)\tag{2-24}
$$

$$
x_j(n)=h_j(n)\ast s(n)\tag{2-25}
$$



其中$h_i(n)$$h_j(n)$包含了环境混响的影响。对方程（2-24）两边同时卷积$h_j(n)$可得

$$
x_i(n)\ast h_j(n)=[h_i(n)\ast s(n)]\ast h_j(n)=x_j(n) \ast h_i(n)\tag{2-26}
$$
写为矩阵形式即
$$
x_i^T(n)h_j=x_j^T(n)h_i\tag{2-27}
$$
其中$x_i$和$h_i$分别为第$i$个麦克风接收到的观察信号矢量和脉冲响应矢量,

如果令$R_{x_ix_j}=E[x_i(n)x_j^T(n)]$，定义协方差矩阵
$$
\begin{matrix}   R_{x_ix_i} & R_{x_ix_j} \\   R_{x_jx_i} & R_{x_jx_j}  \end{matrix} \tag{2-28}
$$
及2N*1的矢量，

$$
u=[h_j-h_i]^T\tag{2-29}
$$
从式（2-27）可以看出$R_{xx}u=0$，也就是说矢量$u$为协方差矩阵$R_{xx}$对应于零特征值的特征矢量。理论上讲，如果两个脉冲响应$h_i$和$h_j$没有公共零点，且由信号源$s(n)$所产生的自相关矩阵是满秩的，则$R_{xx}$有且只有一个特征值为零

在获得信号的协方差矩阵后，通过求取对应于零特征值的特征矢量就可以得到两个通道的脉冲响应，进而估计出TDOA值。这就是基于EVD的时延估计方法。在实际中，该方法可以通过自适应滤波来实现。此时，仿照LMS方法定义误差函数

$$
e(n)=x_i(n)\ast h_j(n)-x_j(n)*h_i(n)\tag{2-30}
$$
基于EVD的时延估计算法框图如图2.5所示

<center><img src="https://pangcong1117.github.io/myblog/images/基于麦克风阵列的声源定位与语音增强方法研究_图2.5基于EVD的时延估计算法实现框图.png"/>


比较式(2-30)与LMS方法的误差函数$e(n)=x_i(n)-x_j^T(n)*h_i(n)$可以看出，EVD方法又加入了一个调整项$h_j(n)$。从原理上讲，LMS方法相当于将$x_i(n)$看作目标信号，对$x_j(n)$滤波去逼近$x_i(n)$，这样做没有考虑到$x_i(n)$中的反射及噪声的影响。而自适应EVD的方法同时调整两个通道的脉冲响应，让两者的输出相互逼近，从而更接近于实际模型，所以EVD方法可以看作是改进的LMS方法。进一步地，与LMS方法及PHAT加权的GCC方法相比，EVD方法是建立在带有混响的模型基础之上的，所以具有更好的抗混响性能。然而EVD方法也存在不足之处，首先在实现过程中它的计算量是GCC＋PHAT方法的3倍多，而且还需要几帧的平滑，进一步加大了计算量；其次，它在模型假设中忽略了噪声的影响，如果有噪声存在，脉冲响应的峰值将受到噪声影响而产生误差；最后，这一方法更多的关注了两个脉冲响应的峰值位置，对其余分量的估计不够精确，因此无法通过对脉冲响应的插值来提高时延估计的精度。

想法：自适应过程中重视高信噪比段，轻视低信噪比段



限于EVD方法只能处理空间白噪声的情景，Doclo在EVD方法的基础上做了改进，提出了GEVD方法[11,59]，**主要针对空间有色噪声信号模型**：

$$
y_i(n)=h_i(n)*s(n)+v_i(n)=x_i(n)+v_i(n)\tag{2-31}
$$

$$
y_j(n)=h_j(n)*s(n)+v_j(n)=x_j(n)+v_j(n)\tag{2-32}
$$



其中$v_i(n)$和$v_j(n)$为空间色噪声。

一般来讲，对于空间有色噪声处理方法有两种：1) 对信号协方差矩阵进行广义特征值分解；2) 对信号相关函数进行预白化 (prewhitening) 变换。文献[11,59]中，作者从这两方面出发，使得TDE性能在处理空间相关性噪声时有了进一步改善。

无论是广义特征值分解还是预白化变换，它们都是建立在空间有色噪声模型的基础上，因此其应用于实际环境中的性能要优于EVD方法。然而，GEVD方法需要对噪声的统计特性进行预先估计，由于加入了噪声相关矩阵，GEVD算法加大了计算量。另一方面，噪声相关矩阵是从无声段的语音中获得的，如果数据量不够或者更新太慢，噪声相关矩阵的估计就不够准确，这样反而会引入误差。

##### 2.2.9基于声学传递函数比的时延估计法

在文献[37]中，Dvorkind给出了一种利用两个通道的声学传递函数比 (acous-tic transfer functions ratio, ATF比) 来进行时延估计的方法，它同样建立在带有混响和相关性噪声的模型基础之上。

未掌握，待整理

利用ATF比进行TDOA估计具有以下几方面的特点：首先，ATF比方法的基本模型是针对有混响和方向性噪声的信号模型而建立的，这更符合实际环境；其次，ATF比算法的处理在频域进行，其计算效率要比EVD/GEVD方法高；最后，在估计Ai(ω)的过程中，ATF比方法并不需要做语音活动检测 (voice activitydetection, VAD) 来区分噪声段和语音段，也不需要有关噪声统计特性的先验知识，这方便了噪声特性复杂难以估计的场合。需要指出的是，算法在估计ai(n)时，其峰值位置的精度受到采样频率的限制，作者在【12】中考虑用Shannon插值公式对ai(n)进行插值来提高TDOA估计精度。然而ai(n) 并非实际路径的脉冲响应，而是两通道传递函数比值的反傅立叶变换，因而一种合理的插值方法需要进一步研究。

想法：一种合理的插值方法